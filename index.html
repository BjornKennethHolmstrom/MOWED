<!DOCTYPE html>
<!--
 MOWED - Reforestation Optimization Tool
 Copyright (c) 2024 Björn Kenneth Holmström
 Licensed under a custom license - see LICENSE file for details.
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOWED - Reforestation Optimization</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>MOWED - Reforestation Optimization</h1>

    <button id="load-example">Load Example Template</button>
    <button id="show-help">Help</button>

    <div id="advanced-options" style="display: none;">
        <h3>Advanced Options</h3>
        <div class="advanced-option">
            <label for="solver">Optimization Solver:</label>
            <select id="solver" name="solver">
                <option value="SLSQP">SLSQP</option>
                <option value="COBYLA">COBYLA</option>
            </select>
        </div>
        <div class="option-category">
            <h4 class="category-toggle">Optimization Parameters</h4>
            <div class="category-content" style="display: none;">
                <label for="max-iterations">Maximum Iterations:</label>
                <input type="number" id="max-iterations" value="2000">
                
                <label for="function-tolerance">Function Tolerance:</label>
                <input type="number" id="function-tolerance" value="1e-8" step="1e-9">
                
                <label for="min-budget-utilization">Minimum Budget Utilization (%):</label>
                <input type="number" id="min-budget-utilization" value="60" min="0" max="100">
                
                <label for="species-diversity-factor">Species Diversity Factor:</label>
                <input type="number" id="species-diversity-factor" value="2" min="1" step="0.1">
            </div>
        </div>

        <div class="option-category">
            <h4 class="category-toggle">Environmental Factors</h4>
            <div class="category-content" style="display: none;">
                <div class="env-factor">
                    <input type="checkbox" id="use-soil-quality" name="use-soil-quality">
                    <label for="use-soil-quality">Use Soil Quality</label>
                    <select id="soil-quality" name="soil-quality" disabled>
                        <option value="poor">Poor</option>
                        <option value="medium" selected>Medium</option>
                        <option value="good">Good</option>
                    </select>
                    <p class="option-description">Select the predominant soil quality of your reforestation area.</p>
                </div>

                <div class="env-factor">
                    <input type="checkbox" id="use-climate-zone" name="use-climate-zone">
                    <label for="use-climate-zone">Use Climate Zone</label>
                    <select id="climate-zone" name="climate-zone" disabled>
                        <option value="tropical">Tropical</option>
                        <option value="dry">Dry</option>
                        <option value="temperate" selected>Temperate</option>
                        <option value="continental">Continental</option>
                        <option value="polar">Polar</option>
                    </select>
                    <p class="option-description">Select the climate zone of your reforestation area.</p>
                </div>

                <div class="env-factor">
                    <input type="checkbox" id="use-elevation" name="use-elevation">
                    <label for="use-elevation">Use Elevation (meters)</label>
                    <input type="number" id="elevation" name="elevation" value="500" min="0" step="1" disabled>
                    <p class="option-description">Enter the average elevation of your reforestation area in meters above sea level.</p>
                </div>

                <div class="env-factor">
                    <input type="checkbox" id="use-annual-rainfall" name="use-annual-rainfall">
                    <label for="use-annual-rainfall">Use Annual Rainfall (mm)</label>
                    <input type="number" id="annual-rainfall" name="annual-rainfall" value="800" min="0" step="1" disabled>
                    <p class="option-description">Enter the average annual rainfall of your reforestation area in millimeters.</p>
                </div>
            </div>
        </div>
        <div class="advanced-option">
            <div class="debug-mode-container">
                <label for="debug-mode">Debug Mode:</label>
                <input type="checkbox" id="debug-mode" name="debug-mode">
            </div>
        </div>
    </div>

    <button id="toggle-advanced">Show Advanced Options</button>

    <form id="optimization-form">
        <label for="budget">Total Budget:</label>
        <input type="number" id="budget" required>

        <label for="land-area">Total Land Area:</label>
        <input type="number" id="land-area" required>

        <label for="years">Number of Years:</label>
        <input type="number" id="years" required>

        <div id="species-inputs">
            <h2>Tree Species</h2>
            <!-- Species inputs will be dynamically added here -->
        </div>

        <button type="button" id="add-species">Add Species</button>

        <button type="submit">Optimize</button>
    </form>

    <div id="results"></div>

    <div id="loading" style="display:none;">Optimizing...</div>

    <div id="help-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Help: Understanding the Results</h2>
            <h3>Objective Value</h3>
            <p>The objective value represents the overall score of the optimization. It combines the total carbon sequestration and biodiversity scores.</p>
            
            <h3>Tree Counts</h3>
            <p>This shows the optimal number of trees to plant for each species to maximize the objective value while staying within budget and land area constraints.</p>
            
            <h3>Impact</h3>
            <ul>
                <li><strong>Total Carbon Sequestration:</strong> The total amount of carbon that will be sequestered by the optimized forest plan. Higher values indicate greater climate change mitigation.</li>
                <li><strong>Total Biodiversity Score:</strong> A measure of the forest's contribution to biodiversity. Higher scores suggest a more diverse and ecologically robust forest.</li>
                <li><strong>Total Cost:</strong> The total financial cost of implementing the optimized forest plan. This should always be less than or equal to your input budget.</li>
                <li><strong>Total Area Used:</strong> The total land area that will be used by the optimized forest plan. This should always be less than or equal to your input land area.</li>
            </ul>
            
            <h3>Interpreting the Results</h3>
            <p>The optimization aims to maximize carbon sequestration and biodiversity while respecting your budget and land constraints. If you see zero trees for some species, it means that planting those species would not contribute optimally to your goals given the constraints.</p>
            
            <p>Remember, this is a simplified model. In real-world reforestation projects, many other factors (like soil types, local climate, and ecological interactions) would also need to be considered.</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/pyodide/v0.22.1/full/pyodide.js"></script>
    <script src="app.js"></script>
</body>
</html>
